(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,87912,e=>{"use strict";e.s(["default",()=>c]);var t=e.i(18050),a=e.i(71645),l=e.i(22016),r=e.i(66125);e.i(36180);var n=e.i(98925),o=e.i(2573),d=e.i(18566),i=e.i(16015),u=e.i(82750);function s(e){let{nodes:a,depth:r=0,onContextMenu:n,onDragStart:o,onDragOver:d,onDrop:i,onDragEnter:u,onDragLeave:c,dragOverId:p}=e;return(0,t.jsx)("ul",{children:a.map(e=>(0,t.jsxs)("li",{onDragOver:t=>d(t,e),onDrop:t=>i(t,e),onDragEnter:t=>u(t,e),onDragLeave:t=>c(t,e),children:[(0,t.jsx)("div",{className:"py-1 px-2 hover:opacity-80 rounded",style:{paddingLeft:"".concat(8+12*r,"px"),backgroundColor:p===e.id?"rgba(37,99,235,0.12)":void 0,outline:p===e.id?"2px solid rgba(37,99,235,0.35)":"none",outlineOffset:0},onContextMenu:t=>n(t,e),draggable:!0,onDragStart:t=>o(t,e),children:(0,t.jsx)(l.default,{href:"/notes/".concat(e.id),style:{color:"var(--foreground)"},children:e.note.title||"(untitled)"})}),e.children.length>0&&(0,t.jsx)(s,{nodes:e.children,depth:r+1,onContextMenu:n,onDragStart:o,onDragOver:d,onDrop:i,onDragEnter:u,onDragLeave:c,dragOverId:p})]},e.id))})}function c(){let[e,l]=(0,a.useState)([]),[c,p]=(0,a.useState)(null),[f,v]=(0,a.useState)(null),[g,b]=(0,a.useState)(null),[h,x]=(0,a.useState)(!1),D=(0,d.useRouter)(),{user:y}=(0,i.useAuth)();(0,a.useEffect)(()=>{let e=(0,n.onSnapshot)((0,n.collection)(r.db,"notes"),e=>{l(e.docs.map(e=>{var t,a,l,r,n,o,d,i,u;let s=e.data();return{id:e.id,title:null!=(t=s.title)?t:"",content:null!=(a=s.content)?a:"",createdBy:null!=(l=s.createdBy)?l:"",visibility:null!=(r=s.visibility)?r:"party",createdAt:s.createdAt,updatedAt:s.updatedAt,tags:null!=(n=s.tags)?n:[],links:null!=(o=s.links)?o:[],template:null!=(d=s.template)?d:null,metadata:null!=(i=s.metadata)?i:{},parentId:null!=(u=s.parentId)?u:null,noteType:s.noteType}}))});return()=>e()},[]);let m=(0,a.useMemo)(()=>(function(e){let t=new Map,a=[];for(let a of e)t.set(a.id,{id:a.id,note:a,children:[]});for(let e of t.values()){var l;let r=null!=(l=e.note.parentId)?l:null;r&&t.has(r)?t.get(r).children.push(e):a.push(e)}let r=e=>{e.sort((e,t)=>e.note.title.localeCompare(t.note.title)),e.forEach(e=>r(e.children))};return r(a),a})(e),[e]),k=(0,a.useMemo)(()=>{let t=new Map;return e.forEach(e=>t.set(e.id,e.parentId)),t},[e]),C=(0,a.useCallback)((e,t)=>{if(e===t)return!0;let a=t,l=new Set;for(;a;){var r;if(a===e)return!0;if(l.has(a))break;l.add(a),a=null!=(r=k.get(a))?r:null}return!1},[k]),j=(0,a.useCallback)(async e=>{if(!y)return;if(!(0,u.canUserEdit)(y.email))return void alert("You don't have permission to create notes.");let t=await (0,o.createNoteWithBlock)({title:"Untitled",createdBy:y.uid,visibility:"party",template:null,metadata:{},parentId:e,noteType:"note",tags:[],links:[]}," ");D.push("/notes/".concat(t)),p(null)},[D,y]),w=(0,a.useCallback)((e,t)=>{e.preventDefault(),p({x:e.clientX,y:e.clientY,nodeId:t.id})},[]),T=(0,a.useCallback)((e,t)=>{v(t.id),e.dataTransfer.setData("text/plain",t.id),e.dataTransfer.effectAllowed="move"},[]),S=(0,a.useCallback)(e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},[]),I=(0,a.useCallback)(async(e,t)=>{e.preventDefault(),e.stopPropagation();let a=f||e.dataTransfer.getData("text/plain");a&&(C(a,t.id)||(await (0,o.updateNote)(a,{parentId:t.id}),v(null),b(null)))},[f,C]),E=(0,a.useCallback)((e,t)=>{e.preventDefault(),b(t.id)},[]),N=(0,a.useCallback)((e,t)=>{e.preventDefault(),b(e=>e===t.id?null:e)},[]),A=(0,a.useCallback)(e=>{e.preventDefault(),e.dataTransfer.dropEffect="move",x(!0)},[]),M=(0,a.useCallback)(async e=>{e.preventDefault();let t=f||e.dataTransfer.getData("text/plain");t&&(await (0,o.updateNote)(t,{parentId:null}),v(null),b(null),x(!1))},[f]),O=(0,a.useCallback)(()=>x(!0),[]),B=(0,a.useCallback)(()=>x(!1),[]);return(0,t.jsxs)("aside",{className:"w-64 h-full overflow-y-auto",style:{backgroundColor:"var(--surface)",color:"var(--foreground)",borderRight:"1px solid var(--border)"},children:[(0,t.jsx)("div",{className:"p-4 font-bold text-lg",style:{borderBottom:"1px solid var(--border)",backgroundColor:h?"rgba(37,99,235,0.12)":void 0,outline:h?"2px solid rgba(37,99,235,0.35)":"none"},onDragOver:A,onDrop:M,onDragEnter:O,onDragLeave:B,children:"Notes"}),(0,t.jsx)("div",{onMouseDown:()=>c&&p(null),children:(0,t.jsx)(s,{nodes:m,onContextMenu:w,onDragStart:T,onDragOver:S,onDrop:I,onDragEnter:E,onDragLeave:N,dragOverId:g})}),c&&(0,t.jsx)("div",{style:{position:"fixed",left:c.x,top:c.y,background:"var(--surface)",color:"var(--foreground)",border:"1px solid var(--border)",borderRadius:6,boxShadow:"0 4px 12px rgba(0,0,0,0.2)",zIndex:1e3,minWidth:160},onMouseDown:e=>e.stopPropagation(),children:(0,t.jsx)("button",{className:"w-full text-left px-3 py-2 hover:opacity-80",onClick:()=>j(c.nodeId),children:"Add sub-note"})})]})}},40681,e=>{"use strict";e.s(["default",()=>l]);var t=e.i(18050),a=e.i(87912);function l(e){let{children:l}=e;return(0,t.jsxs)("div",{className:"flex",style:{backgroundColor:"var(--background)",color:"var(--foreground)",height:"calc(100vh - 57px)"},children:[(0,t.jsx)(a.default,{}),(0,t.jsx)("main",{className:"flex-1 p-4 overflow-auto",style:{backgroundColor:"var(--background)",color:"var(--foreground)"},children:l})]})}}]);