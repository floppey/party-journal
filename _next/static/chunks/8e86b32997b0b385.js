(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,87912,e=>{"use strict";e.s(["default",()=>c]);var t=e.i(18050),r=e.i(71645),a=e.i(22016),l=e.i(66125);e.i(36180);var o=e.i(98925),n=e.i(2573),s=e.i(18566),d=e.i(16015),i=e.i(82750);function u(e){let{nodes:r,depth:l=0,onContextMenu:o,onDragStart:n,onDragOver:s,onDrop:d,onDragEnter:i,onDragLeave:c,dragOverId:f}=e;return(0,t.jsx)("ul",{children:r.map(e=>(0,t.jsxs)("li",{onDragOver:t=>s(t,e),onDrop:t=>d(t,e),onDragEnter:t=>i(t,e),onDragLeave:t=>c(t,e),children:[(0,t.jsx)("div",{className:"py-1 px-2 hover:opacity-80 rounded",style:{paddingLeft:"".concat(8+12*l,"px"),backgroundColor:f===e.id?"rgba(37,99,235,0.12)":void 0,outline:f===e.id?"2px solid rgba(37,99,235,0.35)":"none",outlineOffset:0},onContextMenu:t=>o(t,e),draggable:!0,onDragStart:t=>n(t,e),children:(0,t.jsx)(a.default,{href:"/notes/".concat(e.id),style:{color:"var(--foreground)"},children:e.note.title||"(untitled)"})}),e.children.length>0&&(0,t.jsx)(u,{nodes:e.children,depth:l+1,onContextMenu:o,onDragStart:n,onDragOver:s,onDrop:d,onDragEnter:i,onDragLeave:c,dragOverId:f})]},e.id))})}function c(){let[e,a]=(0,r.useState)([]),[c,f]=(0,r.useState)(null),[p,v]=(0,r.useState)(null),[g,x]=(0,r.useState)(null),[h,b]=(0,r.useState)(!1),m=(0,s.useRouter)(),{user:y}=(0,d.useAuth)();(0,r.useEffect)(()=>{let e=(0,o.onSnapshot)((0,o.collection)(l.db,"notes"),e=>{a(e.docs.map(e=>{var t,r,a,l,o,n,s,d,i;let u=e.data();return{id:e.id,title:null!=(t=u.title)?t:"",content:null!=(r=u.content)?r:"",createdBy:null!=(a=u.createdBy)?a:"",visibility:null!=(l=u.visibility)?l:"party",createdAt:u.createdAt,updatedAt:u.updatedAt,tags:null!=(o=u.tags)?o:[],links:null!=(n=u.links)?n:[],template:null!=(s=u.template)?s:null,metadata:null!=(d=u.metadata)?d:{},parentId:null!=(i=u.parentId)?i:null,noteType:u.noteType}}))});return()=>e()},[]);let j=(0,r.useMemo)(()=>(function(e){let t=new Map,r=[];for(let r of e)t.set(r.id,{id:r.id,note:r,children:[]});for(let e of t.values()){var a;let l=null!=(a=e.note.parentId)?a:null;l&&t.has(l)?t.get(l).children.push(e):r.push(e)}let l=e=>{e.sort((e,t)=>e.note.title.localeCompare(t.note.title)),e.forEach(e=>l(e.children))};return l(r),r})(e),[e]),k=(0,r.useMemo)(()=>{let t=new Map;return e.forEach(e=>t.set(e.id,e.parentId)),t},[e]),C=(0,r.useCallback)((e,t)=>{if(e===t)return!0;let r=t,a=new Set;for(;r;){var l;if(r===e)return!0;if(a.has(r))break;a.add(r),r=null!=(l=k.get(r))?l:null}return!1},[k]),D=(0,r.useCallback)(async e=>{if(!y)return;if(!(0,i.canUserEdit)(y.email))return void alert("You don't have permission to create notes.");let t=await (0,n.createNoteWithBlock)({title:"Untitled",createdBy:y.uid,visibility:"party",template:null,metadata:{},parentId:e,noteType:"note",tags:[],links:[]}," ");m.push("/notes/".concat(t)),f(null)},[m,y]),w=(0,r.useCallback)((e,t)=>{e.preventDefault(),f({x:e.clientX,y:e.clientY,nodeId:t.id})},[]),N=(0,r.useCallback)((e,t)=>{v(t.id),e.dataTransfer.setData("text/plain",t.id),e.dataTransfer.effectAllowed="move"},[]),T=(0,r.useCallback)(e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},[]),S=(0,r.useCallback)(async(e,t)=>{e.preventDefault(),e.stopPropagation();let r=p||e.dataTransfer.getData("text/plain");r&&(C(r,t.id)||(await (0,n.updateNote)(r,{parentId:t.id}),v(null),x(null)))},[p,C]),A=(0,r.useCallback)((e,t)=>{e.preventDefault(),x(t.id)},[]),E=(0,r.useCallback)((e,t)=>{e.preventDefault(),x(e=>e===t.id?null:e)},[]),I=(0,r.useCallback)(e=>{e.preventDefault(),e.dataTransfer.dropEffect="move",b(!0)},[]),M=(0,r.useCallback)(async e=>{e.preventDefault();let t=p||e.dataTransfer.getData("text/plain");t&&(await (0,n.updateNote)(t,{parentId:null}),v(null),x(null),b(!1))},[p]),O=(0,r.useCallback)(()=>b(!0),[]),P=(0,r.useCallback)(()=>b(!1),[]);return(0,t.jsxs)("aside",{className:"w-64 h-full overflow-y-auto",style:{backgroundColor:"var(--surface)",color:"var(--foreground)",borderRight:"1px solid var(--border)"},children:[(0,t.jsx)("div",{className:"p-4 font-bold text-lg",style:{borderBottom:"1px solid var(--border)",backgroundColor:h?"rgba(37,99,235,0.12)":void 0,outline:h?"2px solid rgba(37,99,235,0.35)":"none"},onDragOver:I,onDrop:M,onDragEnter:O,onDragLeave:P,children:"Notes"}),(0,t.jsx)("div",{onMouseDown:()=>c&&f(null),children:(0,t.jsx)(u,{nodes:j,onContextMenu:w,onDragStart:N,onDragOver:T,onDrop:S,onDragEnter:A,onDragLeave:E,dragOverId:g})}),c&&(0,t.jsx)("div",{style:{position:"fixed",left:c.x,top:c.y,background:"var(--surface)",color:"var(--foreground)",border:"1px solid var(--border)",borderRadius:6,boxShadow:"0 4px 12px rgba(0,0,0,0.2)",zIndex:1e3,minWidth:160},onMouseDown:e=>e.stopPropagation(),children:(0,t.jsx)("button",{className:"w-full text-left px-3 py-2 hover:opacity-80",onClick:()=>D(c.nodeId),children:"Add sub-note"})})]})}},52683,e=>{"use strict";e.s(["default",()=>u]);var t=e.i(18050),r=e.i(22016),a=e.i(16015),l=e.i(87912),o=e.i(71645),n=e.i(66125);e.i(36180);var s=e.i(98925);function d(){return(0,t.jsx)("div",{className:"min-h-screen flex flex-col items-center justify-center",style:{backgroundColor:"var(--background)",color:"var(--foreground)"},children:(0,t.jsxs)("div",{className:"p-8 rounded shadow w-full max-w-md text-center",style:{backgroundColor:"var(--surface)",color:"var(--foreground)"},children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-4",children:"Party Journal"}),(0,t.jsx)("p",{className:"mb-6",style:{color:"var(--muted)"},children:"A shared, real-time campaign journal for TTRPGs."}),(0,t.jsx)(r.default,{href:"/signin",className:"inline-block py-2 px-4 rounded hover:opacity-90",style:{backgroundColor:"#2563eb",color:"#fff"},children:"Sign in to get started"})]})})}function i(){let[e,a]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{let e=(0,s.onSnapshot)((0,s.collection)(n.db,"notes"),e=>{a(e.docs.length>0)});return()=>e()},[]),(0,t.jsxs)("div",{className:"flex",style:{backgroundColor:"var(--background)",color:"var(--foreground)",height:"calc(100vh - 57px)"},children:[(0,t.jsx)(l.default,{}),(0,t.jsx)("main",{className:"flex-1 p-8 overflow-auto flex flex-col items-center justify-center",style:{backgroundColor:"var(--background)",color:"var(--foreground)"},children:(0,t.jsxs)("div",{className:"p-8 rounded shadow w-full max-w-md text-center",style:{backgroundColor:"var(--surface)",color:"var(--foreground)"},children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-4",children:"Welcome to Party Journal"}),(0,t.jsx)("p",{className:"mb-6",style:{color:"var(--muted)"},children:e?"Your shared, real-time campaign journal for TTRPGs. Select a note from the sidebar to view or edit it, or create a new one.":"Your shared, real-time campaign journal for TTRPGs. Get started by creating your first note."}),(0,t.jsx)(r.default,{href:"/notes/new",className:"inline-block py-2 px-4 rounded hover:opacity-90",style:{backgroundColor:"#2563eb",color:"#fff"},children:e?"Create new note":"Create your first note"})]})})]})}function u(){let{user:e,loading:r}=(0,a.useAuth)();return r?(0,t.jsx)("div",{className:"min-h-screen flex flex-col items-center justify-center",style:{backgroundColor:"var(--background)",color:"var(--foreground)"},children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,t.jsx)("p",{style:{color:"var(--muted)"},children:"Loading..."})]})}):e?(0,t.jsx)(i,{}):(0,t.jsx)(d,{})}}]);